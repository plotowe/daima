<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>爱心~</title>
    <style>
        :root{ --glow-r1:10px; --glow-r2:22px; }
        html,body{
            height:100%;margin:0;overflow:hidden;
            font-family:"微软雅黑",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
            transition:background 1s;
            /* 强制设置为黑色背景 */
            background-color: #000; 
            background:
                radial-gradient(1200px 600px at 50% 45%, rgba(18,18,18,.8), rgba(0,0,0,0) 60%),
                radial-gradient(circle at 50% 45%, #121212 0%, #000000 100%);
            color:#eee;
        }
        
        .stage{position:relative;width:100%;height:100%;}

        .msg{
            position:absolute;left:50%;top:50%;
            padding:10px 16px;border-radius:16px;
            color:#fff;font-weight:700;
            font-size:clamp(14px,3vmin,22px);
            text-shadow:0 2px 8px rgba(0,0,0,.28);
            opacity:0;
            transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
            animation: flight var(--dur) cubic-bezier(.25,.7,.3,1) var(--delay) both;
            box-shadow:none;
            filter: drop-shadow(0 0 var(--glow-r1) var(--glow1, rgba(0,0,0,0)))
                    drop-shadow(0 0 var(--glow-r2) var(--glow2, rgba(0,0,0,0)));
            will-change: transform, opacity; 
            background: var(--bg);
        }

        @keyframes flight{
            0%{
                opacity:0;
                transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
            }
            18%{ opacity:1; }
            45%{
                transform:translate(-50%,-50%) translate(calc(var(--dx)*.2),calc(var(--dy)*.2)) scale(1.06);
            }
            70%{
                transform:translate(-50%,-50%) translate(calc(var(--dx)*1.15),calc(var(--dy)*1.15)) scale(.95) rotate(var(--rot));
            }
            88%{
                opacity:1;
                transform:translate(-50%,-50%) translate(calc(var(--heart-x)*.6),calc(var(--heart-y)*.6)) scale(.9) rotate(var(--heart-rot));
            }
            100%{
                opacity:1;
                transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot));
            }
        }

        .msg::before,.msg::after{
            content:''; position:absolute; left:50%; top:0;
            background:inherit;
            border-radius:50px 50px 0 0;
            width:22px; height:34px; opacity:0;
            transition:opacity .28s ease;
            transform-origin:0 100%; transform:rotate(-45deg); z-index:0;
        }
        .msg::after{
            left:0; transform-origin:100% 100%; transform:rotate(45deg);
        }
        .msg.heart-mode{ color:#fff; }
        .msg .text{ position:relative; z-index:1; }
        .msg.heart-mode::before,.msg.heart-mode::after{ opacity:1; }

        .msg.locked{
            animation:none;
            transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot));
            opacity:1;
        }
        .msg.locked.pulse{ animation:pulse 2.2s ease-in-out infinite; }
        .msg.locked::before,.msg.locked::after{ display:none; }
        .msg.locked{ filter:none; }
        .msg.locked .text{ text-shadow:0 1px 2px rgba(0,0,0,.12); }

        @keyframes pulse{
            0%,100%{ transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1); }
            50%   { transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1.08); }
        }

        /* 核心动画：慢速淡出 - 时长 5.0s */
        .msg.fade-out{ 
            animation: fade-out 5.0s ease-in forwards; 
        }
        @keyframes fade-out{
            0% { 
                opacity: 1; 
                transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1); 
                filter: blur(0);
                background: var(--bg);
            }
            100% { 
                opacity: 0; 
                transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(0.95); 
                filter: blur(1px);
                background: transparent !important;
            }
        }

        .center-title{
            position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
            font-weight:800; letter-spacing:.12em;
            font-size:clamp(18px,4vmin,28px);
            color:rgba(255,160,200,.9);
            text-shadow:0 0 18px rgba(255,130,200,.35);
            opacity:.0; pointer-events:none;
            transition: opacity 0.5s; 
        }

        #bgMusic { display: none; }
        
        /* 弹窗样式 */
        #welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #fff;
            text-align: center;
            opacity: 1;
            transition: opacity 0.5s;
        }
        #welcome-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #start-button {
            padding: 15px 30px;
            margin-top: 30px;
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #ff758c, #ff7eb3);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 117, 140, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 117, 140, 0.7);
        }
        #overlay-text {
            font-size: clamp(20px, 6vmin, 32px);
            letter-spacing: 0.1em;
            margin-bottom: 10px;
            color: #ffc4d6;
        }

        /* 卡片边缘扩散光效 */
        .edge-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .edge-glow::before,
        .edge-glow::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            box-shadow: 
                0 0 20px 8px rgba(255, 255, 255, 0.4),
                0 0 40px 16px rgba(255, 255, 255, 0.2),
                0 0 60px 24px rgba(255, 255, 255, 0.1);
            animation: glow-pulse 3s ease-in-out infinite;
        }
        
        .edge-glow::after {
            animation-delay: 1.5s;
        }
        
        @keyframes glow-pulse {
            0%, 100% {
                opacity: 0.7;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
        }
    </style>
</head>
<body>
    <div class="stage" id="stage">
        <div class="center-title" id="title">for you ♥</div>
    </div>
    
    <div id="welcome-overlay">
        <div id="overlay-text">您有一份神秘礼物，确定要打开吗？</div>
        <button id="start-button">确定</button>
    </div>
    
    <audio id="bgMusic" loop>
        <source src="https://lf26-music-east.douyinstatic.com/obj/ies-music-hj/7495920705440140091.mp3" type="audio/mpeg">
        <source src="https://lf26-music-east.douyinstatic.com/obj/ies-music-hj/7495920705440140091.mp3" type="audio/ogg">
    </audio>

<script>
const tips=['累了就歇一歇，不着急', '你已经做得很好了', '难过时，我一直都在', '慢慢来，一切都会好的', '别苛责自己，你超棒的', '今天的烦恼，明天就轻了',
    '你值得所有温柔对待', '停一停也没关系，不赶时间', '别把压力都自己扛着', '偶尔脆弱，也是正常的', '你的努力，我都看得见',
    '深呼吸，把焦虑放一放', '就算不完美，也很可爱', '休息不是偷懒，是充电呀', '慢慢来，生活不会亏待你',
    '别担心，困难会过去的', '你不需要事事都做好', '有情绪很正常，别压抑', '平凡的你，也超有力量', '今天辛苦了，奖励自己放松吧',
    '不用和别人比，你有自己的节奏', '不开心就说出来，我听你说', '就算犯错，也值得被原谅', '你不是孤单一人，我陪着你', '慢慢来，好运气在后面等你',
    '别逼自己太紧，偶尔偷懒也可以', '你的感受很重要，别忽略它', '就算暂时没结果，努力也有意义', '难过时哭一哭，没关系的', '你很好，真的很好',
    '生活很难，但你更坚强', '别害怕，我会陪着你走', '不着急证明自己，时间会看见', '偶尔迷茫，也是成长的一部分', '你值得被好好对待',
    '别把自己逼到角落，留些空间给自己', '就算现在很难，未来会更顺的', '你不需要讨好所有人，做自己就好', '慢慢来，一步一步走就好', '你的存在，本身就很有价值'];

const stage  = document.getElementById('stage');
const title  = document.getElementById('title');
const bgMusic = document.getElementById('bgMusic');
const startButton = document.getElementById('start-button');
const overlay = document.getElementById('welcome-overlay');

let totalCurrent = 0;
let totalRemoved = 0; 

const directions = [
    {dx:'0vw',dy:'-80vh'},{dx:'0vw',dy:'80vh'},
    {dx:'-80vw',dy:'0vh'},{dx:'80vw',dy:'0vh'},
    {dx:'-70vw',dy:'-70vh'},{dx:'70vw',dy:'-70vh'},
    {dx:'-70vw',dy:'70vh'},{dx:'70vw',dy:'70vh'},
    {dx:'0vw',dy:'-60vh'},{dx:'0vw',dy:'60vh'},
    {dx:'-60vw',dy:'0vh'},{dx:'60vw',dy:'0vh'}
];

function rand(min,max){return Math.random()*(max-min)+min;}

function hexToRgba(hex,alpha=1){
    const h=hex.replace('#','');
    const short=h.length===3;
    const r=parseInt(short? h[0]+h[0] : h.slice(0,2),16);
    const g=parseInt(short? h[1]+h[1] : h.slice(2,4),16);
    const b=parseInt(short? h[2]+h[2] : h.slice(4,6),16);
    return `rgba(${r},${g},${b},${alpha})`;
}

function randomStyle(){
    const arr=[
        ['#ff758c','#ff7eb3'], ['#a18cd1','#fbc2eb'],
        ['#f6d365','#fda085'], ['#84fab0','#8fd3f4'],
        ['#f093fb','#f5576c'], ['#4facfe','#00f2fe'],
        ['#43e97b','#38f9d7'], ['#fa709a','#fee140'],
        ['#30cfd0','#330867'], ['#5ee7df','#b490ca']
    ];
    const [c1,c2]=arr[Math.floor(Math.random()*arr.length)];
    return {
        bg:`linear-gradient(135deg,${c1},${c2})`,
        glow1:hexToRgba(c1,0.55),
        glow2:hexToRgba(c2,0.35)
    };
}

// 粉红色样式
function pinkStyle(){
    return {
        bg: 'linear-gradient(135deg, #ff758c, #ff7eb3)',
        glow1: hexToRgba('#ff758c', 0.55),
        glow2: hexToRgba('#ff7eb3', 0.35)
    };
}

function heartScale(){
    const minDim = Math.min(window.innerWidth, window.innerHeight);
    let s = Math.round(minDim * 0.023);
    s = Math.max(8, Math.min(22, s));
    return s;
}

function centerYOffset(){
    const portrait = window.innerHeight > window.innerWidth;
    const minDim = Math.min(window.innerWidth, window.innerHeight);
    return portrait ? -minDim * 0.06 : 0;
}

function heartXY(t){
    const s = heartScale();
    const x = s * (16 * Math.sin(t)**3);
    const y = -s * (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
    return {x: x+'px', y: (y + centerYOffset())+'px'};
}

// 创建卡片边缘扩散光效
function createEdgeGlow(parentElement) {
    const edgeGlow = document.createElement('div');
    edgeGlow.className = 'edge-glow';
    parentElement.appendChild(edgeGlow);
    
    // 延迟显示光效
    setTimeout(() => {
        edgeGlow.style.opacity = 1;
    }, 300);
}

function createMsg(i,total){
    const el = document.createElement('div');
    el.className = 'msg';
    
    const isLockedCard = (i === 0);
    if (isLockedCard) { 
        el.classList.add('final-lock');
    }

    const d = directions[Math.floor(Math.random()*directions.length)];
    el.style.setProperty('--dx', d.dx);
    el.style.setProperty('--dy', d.dy);
    el.style.setProperty('--rot', rand(-55,55)+'deg');

    const baseDur = rand(8.5,10.2); 
    el.style.setProperty('--dur', baseDur+'s');
    el.style.setProperty('--delay', (i*0.11 + rand(0,0.35))+'s');
    
    // 如果是最后一个卡片，使用粉红色样式
    const sty = isLockedCard ? pinkStyle() : randomStyle();
    el.style.setProperty('--bg', sty.bg);
    el.style.setProperty('--glow1', sty.glow1);
    el.style.setProperty('--glow2', sty.glow2);

    const t = (i / total) * Math.PI * 2;
    const {x,y} = heartXY(t);
    el.style.setProperty('--heart-x', x);
    el.style.setProperty('--heart-y', y);
    el.style.setProperty('--heart-rot', rand(-18,18)+'deg');

    const span = document.createElement('span');
    span.className = 'text';
    span.textContent = isLockedCard ? '你是独一无二的' : tips[Math.floor(Math.random()*tips.length)];
    el.appendChild(span);

    const delay = parseFloat(el.style.getPropertyValue('--delay'));
    const dur   = parseFloat(el.style.getPropertyValue('--dur'));
    const switchAt = delay + dur * 0.86;
    const switchTimer = setTimeout(()=>{ el.classList.add('heart-mode'); }, switchAt*1000);

    el.addEventListener('animationend',function handler(event){
        if (event.animationName !== 'flight') return;

        clearTimeout(switchTimer);
        el.classList.add('heart-mode','locked','pulse');
        el.style.willChange = 'auto'; 
        
        this.removeEventListener('animationend', handler);

        if (isLockedCard) {
            // 为最后一个卡片添加边缘扩散光效
            setTimeout(() => {
                createEdgeGlow(el);
            }, 300);
            
            setTimeout(()=>{ title.style.opacity = 0.95; }, 500); 

        } else {
            const onHeartDelay = rand(3000, 6000); 
            
            setTimeout(() => {
                el.classList.remove('pulse'); 
                el.classList.add('fade-out'); 
                
                el.addEventListener('animationend', function fadeHandler(event) {
                    if (event.animationName !== 'fade-out') return; 

                    this.removeEventListener('animationend', fadeHandler);
                    
                    this.style.display = 'none'; 
                    this.style.willChange = 'unset';
                    this.style.background = 'transparent';
                    this.style.filter = 'none';

                    totalRemoved++;
                    const finalDelay = (totalRemoved === (totalCurrent - 1)) ? 2000 : 1000; 

                    setTimeout(() => {
                        this.remove();
                    }, finalDelay);

                }, { once: true });

            }, onHeartDelay); 
        }
        
    }, {once:true});

    stage.appendChild(el);
}

function play(){
    stage.querySelectorAll('.msg').forEach(n=>n.remove());
    title.style.opacity = 0;

    const minDim = Math.min(window.innerWidth, window.innerHeight);
    let TOTAL;
    
    if (minDim <= 420) {
        TOTAL = 55; 
    } else if (minDim <= 720) {
        TOTAL = 85; 
    } else {
        TOTAL = 100;
    }
    
    totalCurrent = TOTAL;
    totalRemoved = 0; 
    
    for(let i=0;i<TOTAL;i++) createMsg(i,TOTAL);
}

function playMusic() {
    bgMusic.currentTime = 0;
    bgMusic.play().catch(error => {
        console.error('音乐播放失败:', error);
    });
}

// 处理全屏兼容性
function requestFullScreen(element) {
    if (element.requestFullscreen) {
        element.requestFullscreen();
    } else if (element.mozRequestFullScreen) { /* Firefox */
        element.mozRequestFullScreen();
    } else if (element.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
        element.webkitRequestFullscreen();
    } else if (element.msRequestFullscreen) { /* IE/Edge */
        element.msRequestFullscreen();
    }
}


function init() {
    // 1. 播放音乐
    playMusic();
    // 3. 开始卡片动画
    play();
}

startButton.addEventListener('click', () => {
    // 1. 尝试进入全屏模式 (必须由用户点击触发)
    requestFullScreen(document.documentElement); 
    
    // 2. 移除弹窗
    overlay.classList.add('hidden');
    
    // 3. 启动动画和音乐
    init();

    // 延时移除 DOM 元素
    setTimeout(() => {
        overlay.remove(); 
    }, 500); 
});


// 窗口大小变化防抖重绘
let resizeTimer;
window.addEventListener('resize', ()=>{ 
    clearTimeout(resizeTimer); 
    resizeTimer = setTimeout(()=> play(), 150); 
});
</script>
</body>
</html>
